<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454267)"/><meta name="author" content="ç®¡ä¼Ÿ"/><meta name="created" content="2016-11-14 05:28:15 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2016-12-24 11:04:00 +0000"/><title>timer ç›¸å…³å‡½æ•°ç»†èŠ‚è§£æ - setInterval - 1</title></head><body><style>
    a { color: #43B0D6 !important; }
    a:visited { color: #7b7ed2 !important; }
    .title-p { font-size:12px; color:gray; }
    .title-hr { margin-bottom: 20px; }
    .tail-hr { margin-top: 20px; }
    .tail-licenses { border:1px dashed lightgray; margin:20px 0 20px 0; padding:20px; font-size:14px; }
</style>
<h2>timer ç›¸å…³å‡½æ•°ç»†èŠ‚è§£æ - setInterval - 1</h2>
<p class="title-p">ç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ-ä¿æŒç½²å(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">åˆ›æ„å…±äº«3.0è®¸å¯è¯</a>)</p>
<p class="title-p">æ–‡ç« ä½œè€…ï¼šPooky (<a href="mailto:guananddu@icloud.com">guananddu@icloud.com</a>)</p>
<hr class="title-hr"><div>æ­¤èŠ‚å¼€å§‹åˆ†æ setInterval ç›¸å…³é€»è¾‘ï¼š</div><div><br/></div><div>setInterval æœ€ç»ˆè°ƒå…¥ timers.js æ–‡ä»¶ä¸­çš„ï¼š</div><div><br/></div><div><pre style="background-color: rgb(43, 43, 43); color: rgb(169, 183, 198); font-family: Menlo;"><font style="font-size: 14px;"><span style="background-color: rgb(52, 65, 52);">exports</span>.setInterval = <span style="color: rgb(204, 120, 50); font-weight: bold;">function</span>(callback<span style="color: rgb(204, 120, 50);">, </span>repeat) {<br/>Â  <span style="color: rgb(204, 120, 50); font-weight: bold;">if </span>(<span style="color: rgb(204, 120, 50); font-weight: bold;">typeof </span>callback !== <span style="color: rgb(106, 135, 89);">'function'</span>) {<br/>Â Â Â  <span style="color: rgb(204, 120, 50); font-weight: bold;">throw new </span>TypeError(<span style="color: rgb(106, 135, 89);">'"callback" argument must be a function'</span>)<span style="color: rgb(204, 120, 50);">;<br/></span><span style="color: rgb(204, 120, 50);">Â  </span>}<br/><br/>Â  repeat *= <span style="color: rgb(104, 151, 187);">1</span><span style="color: rgb(204, 120, 50);">; </span><span style="color: rgb(128, 128, 128);">// coalesce to number or NaN<br/></span><span style="color: rgb(128, 128, 128);"><br/></span><span style="color: rgb(128, 128, 128);">Â  </span><span style="color: rgb(204, 120, 50); font-weight: bold;">if </span>(!(repeat &gt;= <span style="color: rgb(104, 151, 187);">1 </span>&amp;&amp; repeat &lt;= TIMEOUT_MAX)) {<br/>Â Â Â  repeat = <span style="color: rgb(104, 151, 187);">1</span><span style="color: rgb(204, 120, 50);">; </span><span style="color: rgb(128, 128, 128);">// schedule on next tick, follows browser behaviour<br/></span><span style="color: rgb(128, 128, 128);">Â  </span>}<br/><br/>Â  <span style="color: rgb(204, 120, 50); font-weight: bold;">var </span>timer = <span style="color: rgb(204, 120, 50); font-weight: bold;">new </span>Timeout(repeat)<span style="color: rgb(204, 120, 50);">;// åé¢çœç•¥</span></font><font size="4"
/></pre></div><div><br/></div><div>ä¼šæ–°å»ºä¸€ä¸ª Timeout å¯¹è±¡ï¼š</div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/E96C68F3-5753-44A9-B437-5BCF49FF643C.png" height="auto" width="100%"/><br/></div><div><br/></div><div>å¯è§ï¼Œå…¶å»¶è¿Ÿå‚æ•°è¢«åˆå§‹åŒ–ä¸º this._idleTimeout å±æ€§ï¼Œæ¥ç€å¾€ä¸‹åˆå§‹åŒ–ï¼Œæ³¨æ„å…¶å…³é”®å±æ€§çš„èµ‹å€¼ï¼š</div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/3A8FB49A-D942-468C-BEB6-839258424828.png" height="auto" width="100%"/><br/></div><div><br/></div><div>timer._onTimeout æŒ‡å‘ä¸€ä¸ªå†…éƒ¨çš„wrapperå‡½æ•°ï¼Œè€Œï¼Œ_repeat åˆ™æŒ‡å‘è¢«ç®€æ˜“åŒ…è£…åçš„ç”¨æˆ·å›è°ƒå‡½æ•°ã€‚</div><div><br/></div><div>exports.setInterval å‡½æ•°çš„æœ€åï¼Œè°ƒç”¨ active( timer ) å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ–°åˆ›å»ºçš„Timeoutå¯¹è±¡ã€‚</div><div><br/></div><div>æ¥çœ‹çœ‹ active(timer) çš„é€»è¾‘ï¼š</div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/60B2C775-1419-4EBC-B1C7-87DF1447ECB5.png" height="auto" width="100%"/><br/></div><div><br/></div><div>active å‡½æ•°åˆè°ƒç”¨äº† insert å‡½æ•°ï¼š</div><div><br/></div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51);">// The underlying logic for scheduling or re-scheduling a timer.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">//</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">// Appends a timer onto the end of an existing timers list, or creates a new</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">// TimerWrap backed list if one does not already exist for the specified timeout</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">// duration.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">function insert(item, unrefed) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // msecs å³ä¸ºintervalé—´éš”æ—¶é—´ï¼Œæ¯«ç§’è®°</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â const msecs = item._idleTimeout;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â if (msecs &lt; 0 || msecs === undefined) return;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // è¿™é‡Œè°ƒç”¨äº†bindingçš„c++å®ç°ï¼Œè§ä¸‹</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â item._idleStart = TimerWrap.now();</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // çœŸæ­£å†³å®šé‡‡ç”¨å“ªä¸ªlistå¯¹è±¡ï¼š</font></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/B4020FFC-2E49-4ED6-BAF8-762C10FEFFAE.png" height="auto" width="100%"/><br/></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // çœŸæ­£åŒºåˆ«è§æ³¨é‡Šï¼Œä¸€èˆ¬æƒ…å†µä¸‹ unrefed == falseï¼Œé»˜è®¤ä½¿ç”¨ refedLists</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â const lists = unrefed === true ? unrefedLists : refedLists;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // æ£€æŸ¥æ˜¯ä¸æ˜¯å·²ç»å­˜åœ¨ä¸€ä¸ªäº†ï¼Œkeyå³ä½setIntervalçš„æ—¶é—´</font></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/8AD5A84D-68C8-4F28-ACAA-CCEFC1864EDA.png" height="auto" width="100%"/><br/></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // Use an existing list if there is one, otherwise we need to make a new one.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â var list = lists[msecs];</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â if (!list) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â debug('no %d list was found in insert, creating a new one', msecs);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // Make a new linked list of timers, and create a TimerWrap to schedule</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // processing for the list.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // çœ‹çœ‹ç»†èŠ‚ï¼Œæ³¨æ„è¿™é‡Œçš„ç»†èŠ‚ï¼Œæœ‰ new TimerWrap() çš„é€»è¾‘ï¼Œä¼šè°ƒç”¨è‡³c++å±‚é¢ã€è¯¦è§ä¸‹æ–¹åˆ†æã€‘</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // æ¯ä¸€ä¸ªdelayèŠ‚ç‚¹çš„timerslistéƒ½ä¼šåˆä¸€ä¸ªTimerWrapçš„åº•å±‚å¯¹è±¡å¼•ç”¨</font></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/E87BB754-8EE9-4F92-AD89-39F48BBD4D1B.png" height="auto" width="100%"/><br/></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â list = new TimersList(msecs, unrefed);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // å°†å…¶åˆå§‹åŒ–ä¸ºä¸€ä¸ªç©ºçš„åŒå‘é“¾è¡¨</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â L.init(list);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // åº•å±‚çš„ Timer å¯¹è±¡æŒæœ‰å¯¹jså±‚çº§çš„åŒå‘é“¾è¡¨çš„å¼•ç”¨</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â list._timer._list = list;</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â if (unrefed === true) list._timer.unref();</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // å¼€å§‹è°ƒç”¨åº•å±‚Timerå®ä¾‹çš„startæ–¹æ³•ã€è§ä¸‹åˆ†æã€‘</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â list._timer.start(msecs);</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â lists[msecs] = list;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â list._timer[kOnTimeout] = listOnTimeout;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â }</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â L.append(list, item);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â assert(!L.isEmpty(list)); // list is not empty</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">}</font></div><div><br/></div></div><div><br/></div><div>å…³äº TimerWrap.now()ã€é™æ€æ–¹æ³•ã€‘:</div><div><br/></div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â static void Now(const FunctionCallbackInfo&lt;Value&gt;&amp; args) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Environment* env = Environment::GetCurrent(args);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // é€šè¿‡æ·±å…¥è°ƒç”¨ï¼šuv__update_time -&gt; uv__hrtime è¿”å›ç»å¯¹cpuæ—¶é’Ÿæ»´ç­”æ•°ã€æœ€ç»ˆè¿”å›çº³ç§’ã€‘</span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><br/></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â Â <img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/E179BAE2-133C-4E3C-B324-06046AD18A60.png" height="auto" width="100%"/><br/></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><br/></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // ä¸‹æ–¹çš„loop-&gt;timeè¢«æ›´æ–°ä¸ºï¼šÂ <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">timeÂ Â Â Â Â uint64_tÂ Â Â Â Â 10207884</font></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/09010155-BB51-4A1F-AD92-530BABB89564.png" height="auto" width="100%"/><br/></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â  Â Â </font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â  Â  // æ›´æ–°loop-&gt;timeçš„å€¼ï¼ˆæ¯«ç§’ï¼‰</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â  Â  uv_update_time(env-&gt;event_loop());</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/68A4A5F9-3178-4B3D-BBEE-F5282D91175C.png" height="auto" width="100%"/><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â  Â  // uv_now åˆ™è¿”å›æ­¤æ•°å€¼</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">nowÂ Â Â Â Â uint64_tÂ Â Â Â Â 10207884</font></span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â uint64_t now = uv_now(env-&gt;event_loop());</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">timer_base_Â Â Â Â Â uint64_tÂ Â Â Â Â 9722915ã€æ³¨æ„æ­¤å€¼ã€‘</font></span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â CHECK(now &gt;= env-&gt;timer_base());</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // å‡å»timer_baseã€ä¸ºä»€ä¹ˆå‘¢ï¼Ÿã€‘</span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â now -= env-&gt;timer_base();</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // æ ¹æ®å¤§å°è¿”å›ä¸åŒç²¾è¯»çš„å€¼ï¼Ÿ</span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">nowÂ Â Â Â Â uint64_tÂ Â Â Â Â 484969</font></span><br/></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // æœ€ç»ˆè¿”å›è¯»å€¼</span><br/></font></span></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â if (now &lt;= 0xfffffff)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â args.GetReturnValue().Set(static_cast&lt;uint32_t&gt;(now));</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â else</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â args.GetReturnValue().Set(static_cast&lt;double&gt;(now));</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â }</font><br/></div></div><div><br/></div><div>æ€»çš„æ¥è¯´ï¼ŒTimeWrap.now() è¿”å›ä¸€ä¸ªä¸å½“å‰loopç›¸å…³â€œç›¸å¯¹æ—¶é—´ç‚¹ï¼ˆæ¯«ç§’è®°ï¼‰â€ï¼Œç”¨æ¥æ ‡è®°å½“å‰çš„Timeoutå¯¹è±¡çš„å¼€å§‹æ—¶é—´ç‚¹ã€‚</div><div><br/></div><div><hr/></div><div><br/></div><div>å…³äºnew TimerWrap() é€»è¾‘ï¼š</div><div><br/></div><div><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:'Menlo';font-size:13.5pt;"><span style="color:#cc7832;font-weight:bold;">this</span>._timer = <span style="color:#cc7832;font-weight:bold;">new </span>TimerWrap()<span style="color:#cc7832;">;</span>
</pre>éœ€è¦å¤šè¯´ä¸€å¥ï¼Œå› ä¸ºæ­¤ä¸¾ä»£ç ä¼šè°ƒç”¨è‡³åº•å±‚c++ï¼š</div><div><br/></div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0Â Â Â Â Â 0x000000010008dd1c in node::TimerWrap::New(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;) at /Users/mrguan/work/build/node/node-6.6.0/src/timer_wrap.cc:57</font></div><div><br/></div><div>...</div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"> private:</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â static void New(const FunctionCallbackInfo&lt;Value&gt;&amp; args) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â // This constructor should not be exposed to public javascript.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â // Therefore we assert that we are not trying to call this as a</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â // normal function.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // è°ƒç”¨æ¬¡å‡½æ•°å¿…éœ€é‡‡ç”¨æ„é€ å‡½æ•°çš„æ–¹å¼</span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â CHECK(args.IsConstructCall()); // line 57</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Environment* env = Environment::GetCurrent(args);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â new TimerWrap(env, args.This());</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â }</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â TimerWrap(Environment* env, Local&lt;Object&gt; object)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â : HandleWrap(env,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â object,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â reinterpret_cast&lt;uv_handle_t*&gt;(&amp;handle_),</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â AsyncWrap::PROVIDER_TIMERWRAP) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // è¿™ä¸ªåˆå§‹åŒ–å¤ªæ·±å…¥äº†ï¼Œåªè€ƒè™‘æ­¤å±‚çº§çš„æ„é€ é€»è¾‘</span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span>Â  Â  // uv_timer_init å…·ä½“åˆ†æè§ä¸‹ï¼›handle_ æ˜¯ä¸€ä¸ªå®ä¾‹å±æ€§ã€æ–°åˆ›å»ºã€‘</span><br/></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â int r = uv_timer_init(env-&gt;event_loop(), &amp;handle_);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â CHECK_EQ(r, 0);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â }</font><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">...</font></div></div><div><br/></div><div><hr/></div><div><br/></div><div>å…³äºuv_timer_initå‡½æ•°è°ƒç”¨:</div><div><br/></div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51);">#0Â Â Â Â Â 0x000000010102c6dc in uv_timer_init at /Users/mrguan/work/build/node/node-6.6.0/deps/uv/src/unix/timer.c:55</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">int uv_timer_init(uv_loop_t* loop, uv_timer_t* handle) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // uv__handle_init æ˜¯ä¸€ä¸ªå®ï¼Œè§ä¸‹</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â uv__handle_init(loop, (uv_handle_t*)handle, UV_TIMER);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // æ ‡è®°handleçš„timer_cbå±æ€§ä¸ºç©º</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â handle-&gt;timer_cb = NULL;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â handle-&gt;repeat = 0;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â return 0;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">}</font></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/488E4B93-4894-4656-85F9-AFFBABFEE981.png" height="auto" width="100%"/><br/></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/7E303D85-060B-4C86-8BAB-D53DC6BDA0D7.png" height="auto" width="100%"/><br/></div><div><br/></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">uv_timer_s é™¤äº†æ™®é€šçš„ UV_HANDLE_FIELDS å­—æ®µï¼Œè¿˜æœ‰è‡ªå·±çš„ç‰¹æ®Šå­—æ®µï¼Œè§ä¸‹æˆªå›¾ï¼š</font></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/2A89DA05-4AB0-469E-8C99-85E18ABDCAEF.png" height="auto" width="100%"/><br/></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/23D32AC8-494A-4ECC-B82E-313F3AEC9D87.png" height="auto" width="100%"/><br/></div><div><br/></div></div><div><br/></div><div>æ¥çœ‹ uv__handle_init å®ï¼š</div><div><br/></div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a">#define uv__handle_init(loop_, h, type_)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \<br/>Â  do {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \</span></div><div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a"><span>Â  Â  // è®¾ç½®å½“å‰æ–°åˆ›å»ºçš„handleçš„loopå±æ€§ã€åªè¯»ï¼Œæ¯ä¸€ä¸ªhandleå‡æœ‰æ­¤å±æ€§ã€‘</span><br/>Â Â Â  (h)-&gt;loop = (loop_);Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \</span></div><div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a"><span>Â  Â  // è®¾ç½®handleçš„type</span><br/>Â Â Â  (h)-&gt;type = (type_);Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \<br/>Â Â Â  (h)-&gt;flags = UV__HANDLE_REF;Â  </span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #4dbf56">/* Ref the loop when active. */</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a">Â  Â  Â  Â  Â  Â  Â \</span></div><div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a"><span>Â  Â  // å°†æ­¤handleæ’å…¥åˆ°loop-&gt;handle_queueçš„é˜Ÿåˆ—å°¾éƒ¨ã€åŒå‘é“¾è¡¨çš„å°¾éƒ¨ï¼Œæœ€è€ï¼Œå³é“¾è¡¨å¤´çš„prevæŒ‡å‘æ­¤èŠ‚ç‚¹ã€‘</span><br/>Â Â Â  QUEUE_INSERT_TAIL(&amp;(loop_)-&gt;handle_queue, &amp;(h)-&gt;handle_queue);Â Â Â Â Â Â Â Â Â Â Â  \</span></div><div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a"><span>Â  Â  // è§ä¸‹</span><br/>Â Â Â  uv__handle_platform_init(h);Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \<br/>Â  } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \<br/>Â  while (</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #8b84cf">0</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a">)</span><br/></div><div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a"><br/></span></div><div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a"><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a">#if defined(_WIN32)<br/>
# define uv__handle_platform_init(h) ((h)-&gt;u.fd = -</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #8b84cf">1</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #d28f5a">)<br/>
#else<br/>
# define uv__handle_platform_init(h) ((h)-&gt;next_closing = NULL)<br/>
#endif</span><br/></span></div></div><div><br/></div><div>å› æ­¤ï¼Œnew TimerWrap() çš„é€»è¾‘ï¼Œæ˜¯æ–°åˆ›å»ºäº†ä¸€ä¸ªTimerçš„åº•å±‚å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨æ„é€ çš„æ—¶å€™ï¼Œåˆ›å»ºäº†æ–°çš„timer handleï¼Œå¹¶ä¸”å°†æ­¤handleæ’å…¥è‡³loopçš„handle_queueåŒå‘é“¾è¡¨ä¸­çš„æœ€æœ«å°¾çš„ä½ç½®å»ã€‚åº•å±‚é€»è¾‘ï¼Œå‚è§ï¼š</div><div/><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0Â Â Â Â Â 0x000000010008e1fe in node::TimerWrap::TimerWrap(node::Environment*, v8::Local&lt;v8::Object&gt;) at /Users/mrguan/work/build/node/node-6.6.0/src/timer_wrap.cc:69</font></div></div><div/><div><br/></div><div>é€è¿‡åº•å±‚timer_wrapçš„bindingå®ç°ï¼Œå¯çŸ¥ï¼š</div><div><br/></div><div><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:'Menlo';font-size:13.5pt;"><span style="color:#cc7832;font-weight:bold;">const </span>TimerWrap = process.binding(<span style="color:#6a8759;">'timer_wrap'</span>).Timer<span style="color:#cc7832;">;</span>
</pre><div>çš„è¿”å›å€¼åº”è¯¥æ˜¯ä¸€ä¸ªç”±c++å±‚æ¬¡æ¥å®ç°çš„æ„é€ å‡½æ•°ï¼š<br/></div></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/BF562456-72B1-4DA3-B185-682C9D9698EB.png" height="auto" width="100%"/><br/></div><div><br/></div><div>ä¸”ï¼Œå…¶æš´éœ²å‡ºæ¥çš„æ„é€ å‡½æ•°çš„åç§°ä¸ºï¼šTimerï¼Œä¸”ä¸ºå…¶è®¾ç½®äº†nowè¿™ä¸ªé™æ€æ–¹æ³•ï¼Œå’Œä¸€ç³»åˆ—çš„åŸå‹æ–¹æ³•ï¼åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„TimerListså¯¹è±¡çš„æ—¶å€™ï¼Œæ­¤å¯¹è±¡å®ä¾‹ä¼šä¿æœ‰ä¸€ä¸ªthis._timer = new TimerWrap() å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯åº•å±‚çš„Timeræ„é€ å‡ºçš„å¯¹è±¡çš„å¼•ç”¨ï¼åœ¨Timerè¢«åˆå§‹åŒ–æˆåŠŸä»¥åï¼Œä¼šæœ‰æ–°çš„timer handleè¢«åˆ›å»ºï¼Œå¹¶ä¸”è¢«æ’å…¥è‡³loop-&gt;handle_queueåŒå‘é“¾è¡¨é˜Ÿåˆ—ä¸­å»ã€‚</div><div><br/></div><div><hr/></div><div><br/></div><div>å…³äºlist._timer.start(msecs)åº•å±‚è°ƒç”¨ï¼š</div><div><br/></div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51);">#0Â Â Â Â Â 0x000000010008e043 in node::TimerWrap::Start(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;) at /Users/mrguan/work/build/node/node-6.6.0/src/timer_wrap.cc:77</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â static void Start(const FunctionCallbackInfo&lt;Value&gt;&amp; args) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // æ­¤å‡½æ•°æ˜¯åœ¨jså±‚çº§è¢«è°ƒç”¨ï¼Œæ­¤å¥çš„å«ä¹‰ï¼Œæ˜¯æŠŠjså±‚çº§çš„å®ä¾‹å¯¹è±¡ï¼Œè½¬åŒ–ä¸ºc++å±‚çº§çš„å®ä¾‹å¯¹è±¡</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â TimerWrap* wrap = Unwrap&lt;TimerWrap&gt;(args.Holder());</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â CHECK(HandleWrap::IsAlive(wrap));</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // è·å–ç¬¬ä¸€ä¸ªå‚æ•° timeoutÂ Â Â Â Â int64_tÂ Â Â Â Â 2000</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â int64_t timeout = args[0]-&gt;IntegerValue();</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // æœ€ç»ˆè°ƒç”¨æ­¤å¤„çš„é‡è¦å‡½æ•°</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â int err = uv_timer_start(&amp;wrap-&gt;handle_, OnTimeout, timeout, 0);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â args.GetReturnValue().Set(err);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â }</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">==</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">#0Â Â Â Â Â 0x000000010102c788 in uv_timer_start at /Users/mrguan/work/build/node/node-6.6.0/deps/uv/src/unix/timer.c:68</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">int uv_timer_start(uv_timer_t* handle,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â uv_timer_cb cb,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â uint64_t timeout,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â uint64_t repeat) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â uint64_t clamped_timeout;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // cbÂ Â Â Â Â uv_timer_cbÂ Â Â Â Â (node`node::TimerWrap::OnTimeout(uv_timer_s*) at timer_wrap.cc:90)Â Â Â Â Â 0x000000010008e360</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â if (cb == NULL)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â return -EINVAL;</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â if (uv__is_active(handle))</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â uv_timer_stop(handle);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // timeoutÂ Â Â Â Â uint64_tÂ Â Â Â Â 2000</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // clamped_timeoutÂ Â Â Â Â uint64_tÂ Â Â Â Â 13563712</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // è®¡ç®—â€œåˆ°æœŸâ€æ—¶é—´</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â clamped_timeout = handle-&gt;loop-&gt;time + timeout;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â if (clamped_timeout &lt; timeout)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â clamped_timeout = (uint64_t) -1;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // è®¾ç½®æ­¤handleçš„timer_cbå‡½æ•°æŒ‡é’ˆ</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â handle-&gt;timer_cb = cb;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // è®¾ç½®æ­¤handleçš„åˆ°æœŸæ—¶é—´</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â handle-&gt;timeout = clamped_timeout;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // repeatÂ Â Â Â Â uint64_tÂ Â Â Â Â 0</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â handle-&gt;repeat = repeat;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â /* start_id is the second index to be compared in uv__timer_cmp() */</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // è®¾ç½® start_id</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â handle-&gt;start_id = handle-&gt;loop-&gt;timer_counter++;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // é‡ä¸­ä¹‹é‡çš„å‡½æ•°ï¼Œè¿™é‡Œè®¾è®¡ä¸¤ä¸ªç±»å‹è½¬åŒ–ï¼š</font></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/6B09365E-562E-4398-9304-2C11EB1DC65E.png" height="auto" width="100%"/><br/></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/D3D6375F-5DAA-4627-BD3E-42E01F3F606B.png" height="auto" width="100%"/><br/></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°æŒ‡é’ˆ</font></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/372DA9E4-A735-49E1-BC23-0C17C78B4B0D.png" height="auto" width="100%"/><br/></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // å³ä¸€ä¸ªloopä¼šæŒæœ‰ä¸€ä¸ªtimer_heapçš„æœ€å°äºŒå‰æ ‘ã€å®Œå…¨äºŒå‰æ ‘ã€‘</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â heap_insert((struct heap*) &amp;handle-&gt;loop-&gt;timer_heap,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â Â Â Â Â Â Â Â Â // å½“å‰çš„handleèŠ‚ç‚¹</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â Â Â Â Â Â Â Â Â (struct heap_node*) &amp;handle-&gt;heap_node,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â Â Â Â Â Â Â Â Â timer_less_than);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â uv__handle_start(handle);</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â return 0;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">}</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">==</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">è¿›å…¥heap_insertæ¥çœ‹çœ‹ï¼š</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">#0Â Â Â Â Â 0x000000010102ca54 in heap_insert at /Users/mrguan/work/build/node/node-6.6.0/deps/uv/src/heap-inl.h:115</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">HEAP_EXPORT(void heap_insert(struct heap* heap,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â struct heap_node* newnode,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â heap_compare_fn less_than)) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // å½“ç¬¬ä¸€æ¬¡è¿›å…¥çš„æ—¶å€™ï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨setIntervalå‡½æ•°ï¼‰</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // heapÂ Â Â Â Â heap *Â Â Â Â Â 0x101b0c1f8Â Â Â Â Â 0x0000000101b0c1f8</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â //Â Â Â Â Â minÂ Â Â Â Â heap_node *Â Â Â Â Â NULLÂ Â Â Â Â 0x0000000000000000</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â //Â Â Â Â Â neltsÂ Â Â Â Â unsigned intÂ Â Â Â Â 0ã€é™¤å»æ ¹ä¹‹å¤–çš„èŠ‚ç‚¹æ•°ã€‘</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â struct heap_node** parent;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â struct heap_node** child;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â unsigned int path;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â unsigned int n;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â unsigned int k;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // é¦–å…ˆç½®ç©ºæ–°èŠ‚ç‚¹çš„å„ç§æŒ‡é’ˆ</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â newnode-&gt;left = NULL;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â newnode-&gt;right = NULL;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â newnode-&gt;parent = NULL;</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â /* Calculate the path from the root to the insertion point.ï¼ˆè®¡ç®—ä»æ’å…¥ç‚¹åˆ°è·ŸèŠ‚ç‚¹çš„è·ç¦»ï¼‰Â Â This is a min</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â * heap so we always insert at the left-most free node of the bottom row.ã€å¾€æœ€åº•éƒ¨æœ€å·¦è¾¹æ’å…¥æ–°èŠ‚ç‚¹ã€‘</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â */</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â path = 0;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // é»˜è®¤åˆšå¼€å§‹ï¼Œheap-&gt;neltsè‚¯å®šä¸º0</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â for (k = 0, n = 1 + heap-&gt;nelts; n &gt;= 2; k += 1, n /= 2)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â path = (path &lt;&lt; 1) | (n &amp; 1);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // pathÂ Â Â Â Â unsigned intÂ Â Â Â Â 0</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â /* Now traverse the heap using the path we calculated in the previous step. */</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â parent = child = &amp;heap-&gt;min;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â while (k &gt; 0) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â parent = child;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â if (path &amp; 1)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â child = &amp;(*child)-&gt;right;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â else</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â child = &amp;(*child)-&gt;left;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â path &gt;&gt;= 1;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â k -= 1;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â }</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // æ’å…¥æ–°èŠ‚ç‚¹</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â /* Insert the new node. */</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // è®¾ç½®æ–°èŠ‚ç‚¹çš„parent</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â newnode-&gt;parent = *parent;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // ç¬¬ä¸€æ¬¡è°ƒç”¨ä¹‹æ—¶ï¼ŒæŒ‡çš„æ˜¯ loop-&gt;timer_heap-&gt;min æŒ‡å‘æ–°èŠ‚ç‚¹</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â *child = newnode;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // å¯è§neltsè®°å½•çš„æ˜¯äºŒå‰æ ‘çš„èŠ‚ç‚¹æ€»æ•°</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â heap-&gt;nelts += 1;</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â /* Walk up the tree and check at each node if the heap property holds.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â * It's a min heap so parent &lt; child must be true.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â */</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // ç¬¬ä¸€æ¬¡æ‰§è¡ŒsetIntervalæ—¶ï¼Œæ­¤åˆ†æ”¯ä¸ä¼šæ‰§è¡Œ</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â while (newnode-&gt;parent != NULL &amp;&amp; less_than(newnode, newnode-&gt;parent))</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â heap_node_swap(heap, newnode-&gt;parent, newnode);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">}</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">==</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">ğŸŒŸ ç¬¬ä¸€æ¬¡æ‰§è¡Œ setInterval æ—¶ï¼Œåªä¼šåœ¨æœ€å°å®Œå…¨äºŒå‰å †ä¸­ï¼Œæ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŸ¥çœ‹æ­¤æ—¶å˜é‡æˆªå›¾ï¼š</font></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/F0581B47-EBD6-46CF-A702-0439E5A7449B.png" height="auto" width="100%"/><br/></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">å¯è§ï¼Œheap-&gt;min å°±æ˜¯ï¼ˆæŒ‡å‘ï¼‰ newnode èŠ‚ç‚¹</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">==</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">ğŸŒŸ è¿›å…¥å®ï¼šuv__handle_start(handle)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">#define uv__handle_start(h)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â do {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â assert(((h)-&gt;flags &amp; UV__HANDLE_CLOSING) == 0);Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // æ ‡è®°å…¶æ¿€æ´»çŠ¶æ€</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â if (((h)-&gt;flags &amp; UV__HANDLE_ACTIVE) != 0) break;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â (h)-&gt;flags |= UV__HANDLE_ACTIVE;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // æ­¤åˆ†æ”¯çš„ç¡®ä¼šè¿›å…¥ã€æ³¨æ„æ­¤èŠ‚çš„ä¸Šæ–¹æœ‰ç›¸å…³é€»è¾‘ã€‘</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â if (((h)-&gt;flags &amp; UV__HANDLE_REF) != 0) uv__active_handle_add(h);Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â }Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â while (0)</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">#define uv__active_handle_add(h)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â do {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â // timer handleä¼šä½¿å¾—è¿™é‡ŒåŠ 1</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â (h)-&gt;loop-&gt;active_handles++;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â }Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â while (0)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">==</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">ğŸŒŸç¬¬äºŒä¸ªsetIntervalè°ƒç”¨ï¼Œè¿›å…¥heap_insertä¹‹åçš„å˜é‡æˆªå›¾ï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºç»“æ„ï¼š</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">#0Â Â Â Â Â 0x000000010102cba9 in heap_insert at /Users/mrguan/work/build/node/node-6.6.0/deps/uv/src/heap-inl.h:148</font></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/934E6D74-3724-4D48-8672-5BBB12A6BD8E.png" height="auto" width="100%"/><br/></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">å¯è§ï¼ŒåŸæ¥çš„æ ¹èŠ‚ç‚¹heap-&gt;minçš„leftä¸Šé¢æ’å…¥äº†ä¸€ä¸ªæ–°çš„å¶å­èŠ‚ç‚¹ï¼Œæ­¤å¶å­èŠ‚ç‚¹çš„parentå³ä¸ºheap-minèŠ‚ç‚¹ï¼›</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">==</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">ğŸŒŸåŒæ ·ï¼Œåœ¨ç¬¬äºŒæ¬¡æ’å…¥å®Œæ¯•ä¹‹åï¼Œä¼šæœ‰æ¯”è¾ƒçˆ¶å­èŠ‚ç‚¹çš„æƒé‡å¤§å°çš„é€»è¾‘ï¼Œä»¥ä¿è¯æ­¤æ ‘å§‹ç»ˆä¸ºæœ€å°å®Œå…¨äºŒå‰å †ç»“æ„ï¼š</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â /* Walk up the tree and check at each node if the heap property holds.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â * It's a min heap so parent &lt; child must be true.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â */</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â while (newnode-&gt;parent != NULL &amp;&amp; less_than(newnode, newnode-&gt;parent))</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â heap_node_swap(heap, newnode-&gt;parent, newnode);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">==</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">ğŸŒŸ æ¥çœ‹çœ‹çˆ¶å­èŠ‚ç‚¹æ¯”è¾ƒå‡½æ•°ï¼š</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">static int timer_less_than(const struct heap_node* ha,</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const struct heap_node* hb) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â const uv_timer_t* a;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â const uv_timer_t* b;</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â a = container_of(ha, const uv_timer_t, heap_node);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â b = container_of(hb, const uv_timer_t, heap_node);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â // è°çš„è§¦å‘äº‹ä»¶è¶Šâ€œæ—©â€ï¼Œè°çš„ä½ç½®è¶Šé è¿‘æ ¹èŠ‚ç‚¹</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â if (a-&gt;timeout &lt; b-&gt;timeout)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â return 1;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â if (b-&gt;timeout &lt; a-&gt;timeout)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â return 0;</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â /* Compare start_id when both have the same timeout. start_id is</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â * allocated with loop-&gt;timer_counter in uv_timer_start().</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â */</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â if (a-&gt;start_id &lt; b-&gt;start_id)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â return 1;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â if (b-&gt;start_id &lt; a-&gt;start_id)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â Â Â return 0;</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">Â Â return 0;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">}</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">==</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">ğŸŒŸçˆ¶å­èŠ‚ç‚¹æ¢ä½çš„ç®—æ³•ä¸å†æ·±ç©¶</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51);">==</font></div><div><br/></div></div><div><br/></div><div><hr/><br/></div><div>ã€é™„å½•åŠèµ„æ–™ã€‘</div><div><br/></div><div>æœ‰å…³â€œæœ€å°å®Œå…¨äºŒå‰å †ç»“æ„â€è¯¦ç»†è¯´æ˜ï¼š</div><div><br/></div><div><a href="https://en.wikipedia.org/wiki/Binary_heap">https://en.wikipedia.org/wiki/Binary_heap</a><br/></div><div><br/></div><div><a href="http://baike.baidu.com/item/%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91">http://baike.baidu.com/item/%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91</a><br/></div><div><br/></div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/48F6D219-654C-43FA-B623-EA989883372B.png" height="auto" width="100%"/>Â Â </div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/9AF0A140-AA08-468C-8ADD-FD8367783C1E.png" height="auto" width="100%"/><br/></div><div><br/></div><div>è€Œloop-&gt;timer_heapçš„æ•°æ®ç»“æ„ä¸ºå³å›¾ã€‚</div><div><br/></div><div>å…³äºå®Œå…¨äºŒå‰æ ‘ï¼š</div><div><br/></div><div><img src="timer%20%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%BB%86%E8%8A%82%E8%A7%A3%E6%9E%90%20-%20setInterval%20-%201.resources/C2924C77-422F-497E-88EB-9EDBB904FB9D.png" height="auto" width="100%"/><br/></div><div><br/></div>

<hr class="tail-hr">
<div class="tail-licenses">
<p>ç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ-ä¿æŒç½²å(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">åˆ›æ„å…±äº«3.0è®¸å¯è¯</a>)</p>
<p>æ–‡ç« ä½œè€…ï¼šPooky (<a href="mailto:guananddu@icloud.com">guananddu@icloud.com</a>)</p>
<p>æ›´æ–°æ—¥æœŸï¼šSat Dec 24 2016 19:20:16 GMT+0800 (CST)</p>
</div></body></html>