<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454267)"/><meta name="author" content="管伟"/><meta name="created" content="2016-09-20 05:26:16 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2016-09-20 06:00:31 +0000"/><title>资源加载流程1-9 - HTML 文档资源</title></head><body>
<div><br/></div>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>#0    0x000000010709973a in WebCore::DocumentLoader::startLoadingMainResource() at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/loader/DocumentLoader.cpp:1506</div>
</div>
<div><br/></div>
<div>WebCore::DocumentLoader::startLoadingMainResource 函数的细节分析可谓十分繁杂，不过终于分析完毕了：</div>
<div><br/></div>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>// this    WebDocumentLoaderMac *    0x1165f0a00    0x00000001165f0a00</div>
<div>// m_mainResource    WebCore::CachedResourceHandle&lt;WebCore::CachedRawResource&gt;       </div>
<div>m_mainResource = m_cachedResourceLoader-&gt;requestMainResource(cachedResourceRequest);</div>
</div>
<div><br/></div>
<div>紧接着会进入 becomeMainResourceClient 的逻辑：</div>
<div><br/></div>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>#1    0x0000000107099ee4 in WebCore::DocumentLoader::becomeMainResourceClient() at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/loader/DocumentLoader.cpp:1677</div>
</div>
<div><br/></div>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>
<div>void DocumentLoader::becomeMainResourceClient()</div>
<div>{</div>
</div>
<div>#if ENABLE(CONTENT_FILTERING)</div>
<div>    // 设置内容过滤相关</div>
<div>
<div>    if (m_contentFilter)</div>
<div>        m_contentFilter-&gt;startFilteringMainResource(*m_mainResource);</div>
</div>
<div>#endif</div>
<div>    // 不明了其具体含义</div>
<div>
<div>    m_mainResource-&gt;addClient(this);</div>
<div>}</div>
</div>
</div>
<div><br/></div>
<div>
<hr/></div>
<div><br/></div>
<div>来看下书中的总结：</div>
<div><br/></div>
<div><img src="%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B1-9%20-%20HTML%20%E6%96%87%E6%A1%A3%E8%B5%84%E6%BA%90.resources/E9E4A513-7875-4B09-96D9-53EA9B8BDEB3.png" height="1186" width="1426"/></div>
<div><br/></div>
<div>
<hr/></div>
<div><br/></div>
<div>真正发起请求的实现，是由具体平台来实现的，不再具体深究，我们只关注，当拿到服务器的响应数据时，看一下此时的回调栈：</div>
<div><br/></div>
<div><img src="%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B1-9%20-%20HTML%20%E6%96%87%E6%A1%A3%E8%B5%84%E6%BA%90.resources/2F79BE3E-AD61-4095-A043-F08404A2B706.png" height="378" width="1778"/></div>
<div><br/></div>
<div>其数据是一层一层往上传递的。在下一章将分析如何从字节流转变为 DOM 树。</div>
</body></html>