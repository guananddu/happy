<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454267)"/><meta name="author" content="ç®¡ä¼Ÿ"/><meta name="created" content="2016-12-18 03:05:12 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2016-12-19 07:01:56 +0000"/><title>RenderTree çš„æ„å»ºè¿‡ç¨‹ï¼ˆ åŠå…¶æ¸²æŸ“è‡³å±å¹• ï¼‰ - 1</title></head><body><div>é¦–å…ˆå›é¡¾ä¸€ä¸‹ç†è®ºåŸºç¡€çŸ¥è¯†ï¼ˆ<a href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#The_flow_of_constructing_the_tree">https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#The_flow_of_constructing_the_tree</a>ï¼‰ï¼šÂ </div><div><p style="color: rgb(85, 85, 85); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">åœ¨ DOM æ ‘æ„å»ºçš„åŒæ—¶ï¼Œæµè§ˆå™¨è¿˜ä¼šæ„å»ºå¦ä¸€ä¸ªæ ‘ç»“æ„ï¼šå‘ˆç°æ ‘ã€‚è¿™æ˜¯ç”±å¯è§†åŒ–å…ƒç´ æŒ‰ç…§å…¶æ˜¾ç¤ºé¡ºåºè€Œç»„æˆçš„æ ‘ï¼Œä¹Ÿæ˜¯æ–‡æ¡£çš„å¯è§†åŒ–è¡¨ç¤ºã€‚å®ƒçš„ä½œç”¨æ˜¯è®©æ‚¨æŒ‰ç…§æ­£ç¡®çš„é¡ºåºç»˜åˆ¶å†…å®¹ã€‚
</p><div><p style="color: rgb(85, 85, 85); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Firefox å°†å‘ˆç°æ ‘ä¸­çš„å…ƒç´ ç§°ä¸ºâ€œæ¡†æ¶â€ã€‚WebKit ä½¿ç”¨çš„æœ¯è¯­æ˜¯å‘ˆç°å™¨æˆ–å‘ˆç°å¯¹è±¡ã€‚Â <br/>å‘ˆç°å™¨çŸ¥é“å¦‚ä½•å¸ƒå±€å¹¶å°†è‡ªèº«åŠå…¶å­å…ƒç´ ç»˜åˆ¶å‡ºæ¥ã€‚Â <br/>WebKits RenderObject ç±»æ˜¯æ‰€æœ‰å‘ˆç°å™¨çš„åŸºç±»ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š
</p><pre style="font-family: &quot;Source Code Pro&quot;, monospace; font-size: 15px; white-space: pre-wrap; word-wrap: break-word; color: white; background-color: rgb(68, 68, 68); padding: 1em; border-radius: 2px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="color: rgb(226, 137, 100);">class</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(137, 189, 255);">RenderObject</span><span style="color: rgb(255, 255, 255);">{</span><span style="color: rgb(255, 255, 255);">
Â  </span><span style="color: rgb(226, 137, 100);">virtual</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(226, 137, 100);">void</span><span style="color: rgb(255, 255, 255);"> layout</span><span style="color: rgb(255, 255, 255);">();</span><span style="color: rgb(255, 255, 255);">
Â  </span><span style="color: rgb(226, 137, 100);">virtual</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(226, 137, 100);">void</span><span style="color: rgb(255, 255, 255);"> paint</span><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(137, 189, 255);">PaintInfo</span><span style="color: rgb(255, 255, 255);">);</span><span style="color: rgb(255, 255, 255);">
Â  </span><span style="color: rgb(226, 137, 100);">virtual</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(226, 137, 100);">void</span><span style="color: rgb(255, 255, 255);"> rect repaintRect</span><span style="color: rgb(255, 255, 255);">();</span><span style="color: rgb(255, 255, 255);">
Â  </span><span style="color: rgb(137, 189, 255);">Node</span><span style="color: rgb(255, 255, 255);">*</span><span style="color: rgb(255, 255, 255);"> node</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);">Â  </span><span style="color: rgb(174, 174, 174); font-style: italic;">//the DOM node</span><span style="color: rgb(255, 255, 255);">
Â  </span><span style="color: rgb(137, 189, 255);">RenderStyle</span><span style="color: rgb(255, 255, 255);">*</span><span style="color: rgb(255, 255, 255);"> style</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);">Â  </span><span style="color: rgb(174, 174, 174); font-style: italic;">// the computed style</span><span style="color: rgb(255, 255, 255);">
Â  </span><span style="color: rgb(137, 189, 255);">RenderLayer</span><span style="color: rgb(255, 255, 255);">*</span><span style="color: rgb(255, 255, 255);"> containgLayer</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(174, 174, 174); font-style: italic;">//the containing z-index layer</span><span style="color: rgb(255, 255, 255);"
/><span style="color: rgb(255, 255, 255);">}</span></pre><p style="color: rgb(85, 85, 85); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">æ¯ä¸€ä¸ªå‘ˆç°å™¨éƒ½ä»£è¡¨äº†ä¸€ä¸ªçŸ©å½¢çš„åŒºåŸŸï¼Œé€šå¸¸å¯¹åº”äºç›¸å…³èŠ‚ç‚¹çš„ CSS æ¡†ï¼Œè¿™ä¸€ç‚¹åœ¨ CSS2 è§„èŒƒä¸­æœ‰æ‰€æè¿°ã€‚å®ƒåŒ…å«è¯¸å¦‚å®½åº¦ã€é«˜åº¦å’Œä½ç½®ç­‰å‡ ä½•ä¿¡æ¯ã€‚Â <br/>æ¡†çš„ç±»å‹ä¼šå—åˆ°ä¸èŠ‚ç‚¹ç›¸å…³çš„â€œdisplayâ€æ ·å¼å±æ€§çš„å½±å“ï¼ˆè¯·å‚é˜…<a style="color: rgb(80, 139, 136); text-decoration: underline;" href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#style_computation">æ ·å¼è®¡ç®—</a>ç« èŠ‚ï¼‰ã€‚ä¸‹é¢è¿™æ®µ WebKit ä»£ç æè¿°äº†æ ¹æ® display å±æ€§çš„ä¸åŒï¼Œé’ˆå¯¹åŒä¸€ä¸ª DOM èŠ‚ç‚¹åº”åˆ›å»ºä»€ä¹ˆç±»å‹çš„å‘ˆç°å™¨ã€‚
</p><pre style="font-family: &quot;Source Code Pro&quot;, monospace; font-size: 15px; white-space: pre-wrap; word-wrap: break-word; color: white; background-color: rgb(68, 68, 68); padding: 1em; border-radius: 2px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="color: rgb(137, 189, 255);">RenderObject</span><span style="color: rgb(255, 255, 255);">*</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(137, 189, 255);">RenderObject</span><span style="color: rgb(255, 255, 255);">::</span><span style="color: rgb(255, 255, 255);">createObject</span><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(137, 189, 255);">Node</span><span style="color: rgb(255, 255, 255);">*</span><span style="color: rgb(255, 255, 255);"> node</span><span style="color: rgb(255, 255, 255);">,</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(137, 189, 255);">RenderStyle</span><span style="color: rgb(255, 255, 255);">*</span><span style="color: rgb(255, 255, 255);"> style</span><span style="color: rgb(255, 255, 255);">)</span><span style="color: rgb(255, 255, 255);"
/><span style="color: rgb(255, 255, 255);">{</span><span style="color: rgb(255, 255, 255);">
Â Â Â  </span><span style="color: rgb(137, 189, 255);">Document</span><span style="color: rgb(255, 255, 255);">*</span><span style="color: rgb(255, 255, 255);"> doc </span><span style="color: rgb(255, 255, 255);">=</span><span style="color: rgb(255, 255, 255);"> node</span><span style="color: rgb(255, 255, 255);">-&gt;</span><span style="color: rgb(255, 255, 255);">document</span><span style="color: rgb(255, 255, 255);">();</span><span style="color: rgb(255, 255, 255);">
Â Â Â  </span><span style="color: rgb(137, 189, 255);">RenderArena</span><span style="color: rgb(255, 255, 255);">*</span><span style="color: rgb(255, 255, 255);"> arena </span><span style="color: rgb(255, 255, 255);">=</span><span style="color: rgb(255, 255, 255);"> doc</span><span style="color: rgb(255, 255, 255);">-&gt;</span><span style="color: rgb(255, 255, 255);">renderArena</span><span style="color: rgb(255, 255, 255);">();</span><span style="color: rgb(255, 255, 255);">
Â Â Â  </span><span style="color: rgb(255, 255, 255);">...</span><span style="color: rgb(255, 255, 255);">
Â Â Â  </span><span style="color: rgb(137, 189, 255);">RenderObject</span><span style="color: rgb(255, 255, 255);">*</span><span style="color: rgb(255, 255, 255);"> o </span><span style="color: rgb(255, 255, 255);">=</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(51, 135, 204);">0</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);">

Â Â Â  </span><span style="color: rgb(226, 137, 100);">switch</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(255, 255, 255);">style</span><span style="color: rgb(255, 255, 255);">-&gt;</span><span style="color: rgb(255, 255, 255);">display</span><span style="color: rgb(255, 255, 255);">())</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(255, 255, 255);">{</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">case</span><span style="color: rgb(255, 255, 255);"> NONE</span><span style="color: rgb(255, 255, 255);">:</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">break</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">case</span><span style="color: rgb(255, 255, 255);"> INLINE</span><span style="color: rgb(255, 255, 255);">:</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â Â Â Â Â  o </span><span style="color: rgb(255, 255, 255);">=</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(226, 137, 100);">new</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(255, 255, 255);">arena</span><span style="color: rgb(255, 255, 255);">)</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(137, 189, 255);">RenderInline</span><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(255, 255, 255);">node</span><span style="color: rgb(255, 255, 255);">);</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">break</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">case</span><span style="color: rgb(255, 255, 255);"> BLOCK</span><span style="color: rgb(255, 255, 255);">:</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â Â Â Â Â  o </span><span style="color: rgb(255, 255, 255);">=</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(226, 137, 100);">new</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(255, 255, 255);">arena</span><span style="color: rgb(255, 255, 255);">)</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(137, 189, 255);">RenderBlock</span><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(255, 255, 255);">node</span><span style="color: rgb(255, 255, 255);">);</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">break</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">case</span><span style="color: rgb(255, 255, 255);"> INLINE_BLOCK</span><span style="color: rgb(255, 255, 255);">:</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â Â Â Â Â  o </span><span style="color: rgb(255, 255, 255);">=</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(226, 137, 100);">new</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(255, 255, 255);">arena</span><span style="color: rgb(255, 255, 255);">)</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(137, 189, 255);">RenderBlock</span><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(255, 255, 255);">node</span><span style="color: rgb(255, 255, 255);">);</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">break</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">case</span><span style="color: rgb(255, 255, 255);"> LIST_ITEM</span><span style="color: rgb(255, 255, 255);">:</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â Â Â Â Â  o </span><span style="color: rgb(255, 255, 255);">=</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(226, 137, 100);">new</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(255, 255, 255);">arena</span><span style="color: rgb(255, 255, 255);">)</span><span style="color: rgb(255, 255, 255);" /><span style="color: rgb(137, 189, 255);">RenderListItem</span><span style="color: rgb(255, 255, 255);">(</span><span style="color: rgb(255, 255, 255);">node</span><span style="color: rgb(255, 255, 255);">);</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â Â Â Â Â Â  </span><span style="color: rgb(226, 137, 100);">break</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);">
Â Â Â Â Â Â  </span><span style="color: rgb(255, 255, 255);">...</span><span style="color: rgb(255, 255, 255);">
Â Â Â  </span><span style="color: rgb(255, 255, 255);">}</span><span style="color: rgb(255, 255, 255);">

Â Â Â  </span><span style="color: rgb(226, 137, 100);">return</span><span style="color: rgb(255, 255, 255);"> o</span><span style="color: rgb(255, 255, 255);">;</span><span style="color: rgb(255, 255, 255);"
/><span style="color: rgb(255, 255, 255);">}</span></pre><span style="color: rgb(85, 85, 85); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;">å…ƒç´ ç±»å‹ä¹Ÿæ˜¯è€ƒè™‘å› ç´ ä¹‹ä¸€ï¼Œä¾‹å¦‚è¡¨å•æ§ä»¶å’Œè¡¨æ ¼éƒ½å¯¹åº”ç‰¹æ®Šçš„æ¡†æ¶ã€‚Â </span><div><span style="color: rgb(85, 85, 85); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;">åœ¨ WebKit ä¸­ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ éœ€è¦åˆ›å»ºç‰¹æ®Šçš„å‘ˆç°å™¨ï¼Œå°±ä¼šæ›¿æ¢Â </span><code style="font-family: &quot;Source Code Pro&quot;, monospace; font-size: 18px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">createRenderer</code><span style="color: rgb(85, 85, 85); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none;">æ–¹æ³•ã€‚å‘ˆç°å™¨æ‰€æŒ‡å‘çš„æ ·å¼å¯¹è±¡ä¸­åŒ…å«äº†ä¸€äº›å’Œå‡ ä½•æ— å…³çš„ä¿¡æ¯ã€‚</span></div><h5 style="font-size: 18.9px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-weight: 600; clear: both; max-width: 85%; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">å‘ˆç°æ ‘å’Œ DOM æ ‘çš„å…³ç³»
</h5><span style="color: rgb(85, 85, 85); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none;">å‘ˆç°å™¨æ˜¯å’Œ DOM å…ƒç´ ç›¸å¯¹åº”çš„ï¼Œä½†å¹¶éä¸€ä¸€å¯¹åº”ã€‚éå¯è§†åŒ–çš„ DOM å…ƒç´ ä¸ä¼šæ’å…¥å‘ˆç°æ ‘ä¸­ï¼Œä¾‹å¦‚â€œheadâ€å…ƒç´ ã€‚å¦‚æœå…ƒç´ çš„ display å±æ€§å€¼ä¸ºâ€œnoneâ€ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šæ˜¾ç¤ºåœ¨å‘ˆç°æ ‘ä¸­ï¼ˆä½†æ˜¯ visibility å±æ€§å€¼ä¸ºâ€œhiddenâ€çš„å…ƒç´ ä»ä¼šæ˜¾ç¤ºï¼‰ã€‚</span><p style=" color: rgb(85, 85, 85); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">æœ‰ä¸€äº› DOM å…ƒç´ å¯¹åº”å¤šä¸ªå¯è§†åŒ–å¯¹è±¡ã€‚å®ƒä»¬å¾€å¾€æ˜¯å…·æœ‰å¤æ‚ç»“æ„çš„å…ƒç´ ï¼Œæ— æ³•ç”¨å•ä¸€çš„çŸ©å½¢æ¥æè¿°ã€‚ä¾‹å¦‚ï¼Œâ€œselectâ€å…ƒç´ æœ‰ 3 ä¸ªå‘ˆç°å™¨ï¼šä¸€ä¸ªç”¨äºæ˜¾ç¤ºåŒºåŸŸï¼Œä¸€ä¸ªç”¨äºä¸‹æ‹‰åˆ—è¡¨æ¡†ï¼Œè¿˜æœ‰ä¸€ä¸ªç”¨äºæŒ‰é’®ã€‚å¦‚æœç”±äºå®½åº¦ä¸å¤Ÿï¼Œæ–‡æœ¬æ— æ³•åœ¨ä¸€è¡Œä¸­æ˜¾ç¤ºè€Œåˆ†ä¸ºå¤šè¡Œï¼Œé‚£ä¹ˆæ–°çš„è¡Œä¹Ÿä¼šä½œä¸ºæ–°çš„å‘ˆç°å™¨è€Œæ·»åŠ ã€‚Â <br/>å¦ä¸€ä¸ªå…³äºå¤šå‘ˆç°å™¨çš„ä¾‹å­æ˜¯æ ¼å¼æ— æ•ˆçš„ HTMLã€‚æ ¹æ® CSS è§„èŒƒï¼Œinline å…ƒç´ åªèƒ½åŒ…å« block å…ƒç´ æˆ– inline å…ƒç´ ä¸­çš„ä¸€ç§ã€‚å¦‚æœå‡ºç°äº†æ··åˆå†…å®¹ï¼Œåˆ™åº”åˆ›å»ºåŒ¿åçš„ block å‘ˆç°å™¨ï¼Œä»¥åŒ…è£¹ inline å…ƒç´ ã€‚
</p><p style=" color: rgb(85, 85, 85); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">æœ‰ä¸€äº›å‘ˆç°å¯¹è±¡å¯¹åº”äº DOM èŠ‚ç‚¹ï¼Œä½†åœ¨æ ‘ä¸­æ‰€åœ¨çš„ä½ç½®ä¸ DOM èŠ‚ç‚¹ä¸åŒã€‚æµ®åŠ¨å®šä½å’Œç»å¯¹å®šä½çš„å…ƒç´ å°±æ˜¯è¿™æ ·ï¼Œå®ƒä»¬å¤„äºæ­£å¸¸çš„æµç¨‹ä¹‹å¤–ï¼Œæ”¾ç½®åœ¨æ ‘ä¸­çš„å…¶ä»–åœ°æ–¹ï¼Œå¹¶æ˜ å°„åˆ°çœŸæ­£çš„æ¡†æ¶ï¼Œè€Œæ”¾åœ¨åŸä½çš„æ˜¯å ä½æ¡†æ¶ã€‚
</p><img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%EF%BC%88%20%E5%8F%8A%E5%85%B6%E6%B8%B2%E6%9F%93%E8%87%B3%E5%B1%8F%E5%B9%95%20%EF%BC%89%20-%201.resources/2CE5A044-5E85-4B3E-A61D-C439E363A001.png" height="396" width="731"/>å›¾ï¼šå‘ˆç°æ ‘åŠå…¶å¯¹åº”çš„ DOM æ ‘ (<a style="color: rgb(80, 139, 136); text-decoration: underline;" href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#3_1">3.1</a>)ã€‚åˆå§‹å®¹å™¨ block ä¸ºâ€œviewportâ€ï¼Œè€Œåœ¨ WebKit ä¸­åˆ™ä¸ºâ€œRenderViewâ€å¯¹è±¡ã€‚<h5 style="font-size: 18.9px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-weight: 600; clear: both; max-width: 85%; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">æ„å»ºå‘ˆç°æ ‘çš„æµç¨‹
</h5><p style=" color: rgb(85, 85, 85); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">åœ¨ Firefox ä¸­ï¼Œç³»ç»Ÿä¼šé’ˆå¯¹ DOM æ›´æ–°æ³¨å†Œå±•ç¤ºå±‚ï¼Œä½œä¸ºä¾¦å¬å™¨ã€‚å±•ç¤ºå±‚å°†æ¡†æ¶åˆ›å»ºå·¥ä½œå§”æ‰˜ç»™Â <code style="font-family: &quot;Source Code Pro&quot;, monospace; font-size: 0.9em; color: rgb(51, 51, 51);">FrameConstructor</code>ï¼Œç”±è¯¥æ„é€ å™¨è§£ææ ·å¼ï¼ˆè¯·å‚é˜…<a style="color: rgb(80, 139, 136); text-decoration: underline;" href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#style">æ ·å¼è®¡ç®—</a>ï¼‰å¹¶åˆ›å»ºæ¡†æ¶ã€‚
</p><p style=" color: rgb(85, 85, 85); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">åœ¨ WebKit ä¸­ï¼Œè§£ææ ·å¼å’Œåˆ›å»ºå‘ˆç°å™¨çš„è¿‡ç¨‹ç§°ä¸ºâ€œé™„åŠ â€ã€‚æ¯ä¸ª DOM èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªâ€œattachâ€æ–¹æ³•ã€‚é™„åŠ æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œå°†èŠ‚ç‚¹æ’å…¥ DOM æ ‘éœ€è¦è°ƒç”¨æ–°çš„èŠ‚ç‚¹â€œattachâ€æ–¹æ³•ã€‚
</p><p style=" color: rgb(85, 85, 85); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">å¤„ç† html å’Œ body æ ‡è®°å°±ä¼šæ„å»ºå‘ˆç°æ ‘æ ¹èŠ‚ç‚¹ã€‚è¿™ä¸ªæ ¹èŠ‚ç‚¹å‘ˆç°å¯¹è±¡å¯¹åº”äº CSS è§„èŒƒä¸­æ‰€è¯´çš„å®¹å™¨ blockï¼Œè¿™æ˜¯æœ€ä¸Šå±‚çš„ blockï¼ŒåŒ…å«äº†å…¶ä»–æ‰€æœ‰ blockã€‚å®ƒçš„å°ºå¯¸å°±æ˜¯è§†å£ï¼Œå³æµè§ˆå™¨çª—å£æ˜¾ç¤ºåŒºåŸŸçš„å°ºå¯¸ã€‚Firefox ç§°ä¹‹ä¸ºÂ <code style="font-family: &quot;Source Code Pro&quot;, monospace; font-size: 0.9em; color: rgb(51, 51, 51);">ViewPortFrame</code>ï¼Œè€Œ WebKit ç§°ä¹‹ä¸ºÂ <code style="font-family: &quot;Source Code Pro&quot;, monospace; font-size: 0.9em; color: rgb(51, 51, 51);">RenderView</code>ã€‚è¿™å°±æ˜¯æ–‡æ¡£æ‰€æŒ‡å‘çš„å‘ˆç°å¯¹è±¡ã€‚å‘ˆç°æ ‘çš„å…¶ä½™éƒ¨åˆ†ä»¥ DOM æ ‘èŠ‚ç‚¹æ’å…¥çš„å½¢å¼æ¥æ„å»ºã€‚
</p></div><p style=" color: rgb(85, 85, 85); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 18px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">è¯·å‚é˜…<a style="color: rgb(80, 139, 136); text-decoration: underline;" href="http://www.w3.org/TR/CSS21/intro.html#processing-model">å…³äºå¤„ç†æ¨¡å‹çš„ CSS2 è§„èŒƒ</a>ã€‚
</p><hr/></div><div><br/></div><div>webkit åœ¨ä»€ä¹ˆæ—¶å€™å¼€å§‹åˆ›å»º RenderView?æ¥çœ‹æ–­ç‚¹ï¼š</div><div><br/></div><div><img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%EF%BC%88%20%E5%8F%8A%E5%85%B6%E6%B8%B2%E6%9F%93%E8%87%B3%E5%B1%8F%E5%B9%95%20%EF%BC%89%20-%201.resources/27A9B578-6A41-4280-94D7-BDEE2C5D951D.png" height="1258" width="1446"/><br/></div><div>åœ¨æ¥æ”¶åˆ° data çš„åŒæ—¶ï¼Œå¼€å§‹åˆ›å»º RenderViewTreeï¼š</div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#11Â Â Â Â Â 0x00000001070bd354 in WebCore::Document::createRenderTree() at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/dom/Document.cpp:2225</font></div><div><br/><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">void Document::createRenderTree()</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">{</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â ASSERT(!renderView());</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â ASSERT(!m_inPageCache);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â ASSERT(!m_axObjectCache || this != &amp;topDocument());</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â if (m_isNonRenderedPlaceholder)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â return;</font></div><div><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">thisÂ Â Â Â Â WebCore::HTMLDocument *Â Â Â Â Â 0x1171b6600Â Â Â Â Â 0x00000001171b6600</font></span><br/></div><div><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  //Â <span>Â Â  Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">m_renderViewÂ Â Â Â Â WebCore::RenderPtr&lt;WebCore::RenderView&gt; Â  Â Â </font></span></span><br/></font></span></div><div><span><span>Â  Â  // æ–­ç‚¹æ–­åˆ°äº†è¿™ä¸€æ­¥</span><br/></span></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â // FIXME: It would be better if we could pass the resolved document style directly here.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â m_renderView = createRenderer&lt;RenderView&gt;(*this, RenderStyle::create());</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Node::setRenderer(m_renderView.get());</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â renderView()-&gt;setIsInWindow(true);</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â recalcStyle(Style::Force);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">}</font><br/></div></div><div><hr/>CSS è§£æä¸º CSSOM çš„è¿‡ç¨‹å¹¶æ²¡æœ‰æ‰¾åˆ°ï¼Œç”±äºè°ƒè¯•çš„æ˜¯ Webkit1 æ¶æ„çš„ç¨‹åºï¼Œæ‰€ä»¥æ¨¡å‹æ¯”è¾ƒç®€å•ï¼Œåˆæ­¥è°ƒè¯•ï¼Œæ˜¯åœ¨ WebCore::Document::finishedParsing æ–¹æ³•ä¸­å¼€å§‹åˆå§‹åŒ– RenderTreeï¼š</div><div><img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%EF%BC%88%20%E5%8F%8A%E5%85%B6%E6%B8%B2%E6%9F%93%E8%87%B3%E5%B1%8F%E5%B9%95%20%EF%BC%89%20-%201.resources/DA3A907F-2C26-480C-86FF-04722B600325.png" height="1280" width="1458"/><br/></div><div>å› æ­¤æ¥ä¸‹æ¥çš„ç« èŠ‚å°†ä»æ­¤å‡½æ•°å¼€å§‹ï¼Œä¸€æ¢ç©¶ç«Ÿï¼š</div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0Â Â Â Â Â 0x00000001070ca4d4 in WebCore::Document::finishedParsing() at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/dom/Document.cpp:5017</font></div></div><div><br/></div><div>å½“æ‰§è¡Œè‡³æ­¤å‡½æ•°ä¸­æ—¶ï¼ŒDOM çš„æ„å»ºå·²ç»å®Œæˆï¼Œæœ‰å‡ ä¸ªæœ‰æ„æ€çš„æ—¶é—´åŠå…¶äº‹ä»¶è§¦å‘èŠ‚ç‚¹ï¼š</div><div><img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%EF%BC%88%20%E5%8F%8A%E5%85%B6%E6%B8%B2%E6%9F%93%E8%87%B3%E5%B1%8F%E5%B9%95%20%EF%BC%89%20-%201.resources/323F5077-C29A-4010-A5A3-69EE924373CC.png" height="598" width="1796"/><br/></div><div>è¿™é‡Œè®°å½•äº† domContentLoadedEventStart å’Œ domContentLoadedEventEnd çš„ä¸¤ä¸ªæ—¶é—´èŠ‚ç‚¹ã€‚åŒæ—¶ï¼Œåœ¨è¿™é‡Œè§¦å‘äº† DOMContentLoadedEvent äº‹ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ­¤äº‹ä»¶è§¦å‘æ—¶ï¼Œé¡µé¢ä¸­çš„å¤–é“¾å½¢å¼çš„ cssï¼jsï¼image éƒ½å·²ç»è¢«åŠ è½½å¥½äº†ï¼Œæ€»ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æµè§ˆå™¨æ¨¡å‹ï¼Œå¹¶ä¸å’Œæ ‡å‡†è§„èŒƒç›¸åŒ¹é…ï¼š</div><div><img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%EF%BC%88%20%E5%8F%8A%E5%85%B6%E6%B8%B2%E6%9F%93%E8%87%B3%E5%B1%8F%E5%B9%95%20%EF%BC%89%20-%201.resources/2F893DE4-6757-4C93-9C5D-ABB44C79B0AF.png" height="218" width="1342"/><br/></div><div>æ ‡å‡†çš„è§„èŒƒå®šä¹‰ï¼š</div><div><font style="font-size: 18px;"><span style="color: rgb(59, 60, 64); font-family: 'Open Sans', Arial, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none;">TheÂ </span><code style="padding: 0px; border: 0px; font-style: normal; font-weight: normal; font-family: Consolas, 'Liberation Mono', Courier, monospace; word-wrap: break-word; color: rgb(59, 60, 64); font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">DOMContentLoaded</code><span style="color: rgb(59, 60, 64); font-family: 'Open Sans', Arial, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none;">Â event is fired when the initial HTML document has been completely loaded and parsed, without waiting for stylesheets, images, and subframes to finish loading.Â A very different eventÂ </span><a style="padding: 0px; border: 0px; color: rgb(33, 122, 192); text-decoration: none; font-family: 'Open Sans', Arial, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" href="https://developer.mozilla.org/en-US/docs/Mozilla_event_reference/load"><code style=" padding: 0px; border: 0px; font-style: inherit; font-weight: inherit; font-family: Consolas, 'Liberation Mono', Courier, monospace; word-wrap: break-word;">load</code></a><span style="color: rgb(59, 60, 64); font-family: 'Open Sans', Arial, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none;">Â should be used only to detect a fully-loaded page. It is an incredibly popular mistake to useÂ </span><a style="padding: 0px; border: 0px; color: rgb(33, 122, 192); text-decoration: none; font-family: 'Open Sans', Arial, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" href="https://developer.mozilla.org/en-US/docs/Mozilla_event_reference/load"><code style=" padding: 0px; border: 0px; font-style: inherit; font-weight: inherit; font-family: Consolas, 'Liberation Mono', Courier, monospace; word-wrap: break-word;">load</code></a><span style="color: rgb(59, 60, 64); font-family: 'Open Sans', Arial, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;">Â whereÂ </span><code style="padding: 0px; border: 0px; font-style: normal; font-weight: normal; font-family: Consolas, 'Liberation Mono', Courier, monospace; word-wrap: break-word; color: rgb(59, 60, 64); font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">DOMContentLoaded</code><span style="color: rgb(59, 60, 64); font-family: 'Open Sans', Arial, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none;">Â would be much more appropriate, so be cautious.</span></font></div><div>ä½†æ˜¯è¿™é‡Œå…ˆä¸å…³å¿ƒè¿™äº›æ ‡å‡†è§„èŒƒã€‚</div><div><hr/></div><div>ä¹‹åï¼Œå¼€å§‹ç¬¬ä¸€æ¬¡æ‰§è¡Œ updateStyleIfNeeded() å‡½æ•°ï¼š</div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0Â Â Â Â Â 0x00000001070ca671 in WebCore::Document::finishedParsing() at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/dom/Document.cpp:5041</font></div><div><br/></div><div><span>Â  Â  . . .</span><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â if (RefPtr&lt;Frame&gt; f = frame()) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // FrameLoader::finishedParsing() might end up calling Document::implicitClose() if all</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // resource loads are complete. HTMLObjectElements can start loading their resources from</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // post attach callbacks triggered by recalcStyle().Â Â This means if we parse out an &lt;object&gt;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // tag and then reach the end of the document without updating styles, we might not have yet</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // started the resource load and might fire the window load event too early.Â Â To avoid this</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // we force the styles to be up to date before calling FrameLoader::finishedParsing().</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // See https://bugs.webkit.org/show_bug.cgi?id=36864 starting around comment 35.</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â Â  Â <span>Â  Â  // æ–­ç‚¹è¿›å…¥è¿™é‡Œ</span></span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â updateStyleIfNeeded();</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â f-&gt;loader().finishedParsing();</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â InspectorInstrumentation::domContentLoadedEventFired(*f);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â }</font><br/></div><div><span>Â  Â  . . .</span><br/></div></div><div><br/></div><div>æœ€ç»ˆè¿›å…¥ï¼š</div><div/><div style="box-sizing: border-box; padding: 8px; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0Â Â Â Â Â 0x00000001070ba2be in WebCore::Document::recalcStyle(WebCore::Style::Change) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/dom/Document.cpp:1819</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">// æ­¤å‡½æ•°ä½“æ¯”è¾ƒé•¿ï¼Œåªæ³¨æ„å‡ ä¸ªå…³é”®èŠ‚ç‚¹ï¼š</div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">// thisÂ Â Â Â Â WebCore::HTMLDocument *Â Â Â Â Â 0x1170b4000Â Â Â Â Â 0x00000001170b4000</font><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">// æ ‡è®°ç½®ä½</div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">m_inStyleRecalc = true; // æ ‡è®°è¯´æ˜ Document å·²ç»å¼€å§‹æ ·å¼è®¡ç®—è¿‡ç¨‹</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">bool updatedCompositingLayers = false;</font><br/></div><div><font face="Monaco">// è¿›å…¥å—çº§ä½œç”¨åŸŸé€»è¾‘</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">{</font></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // è¿™ä¸¤ä¸ªæ˜¯ç¥é©¬ç©æ„å„¿ï¼Ÿ</span><br/></font></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Style::PostResolutionCallbackDisabler disabler(*this);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â WidgetHierarchyUpdatesSuspensionScope suspendWidgetHierarchyUpdates;</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">changeÂ Â Â Â Â WebCore::Style::ChangeÂ Â Â Â Â Force</font></span><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â if (m_pendingStyleRecalcShouldForce)</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â change = Style::Force;</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">changeÂ Â Â Â Â WebCore::Style::ChangeÂ Â Â Â Â Force</font></span><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â if (change == Style::Force) {</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // This may get set again during style resolve.</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â m_hasNodesWithPlaceholderStyle = false;</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span>Â Â  Â <span>Â  Â  // è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹</span></span><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span><span><span>Â Â  Â <span>Â  Â  // å¼€å§‹ä¸º document dom å…ƒç´ åˆ›å»ºæ ·å¼å¯¹è±¡</span></span><br/></span></span></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â auto documentStyle = Style::resolveForDocument(*this);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // Inserting the pictograph font at the end of the font fallback list is done by the</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â // font selector, so set a font selector if needed.</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â if (Settings* settings = this-&gt;settings()) {</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â Â Â Â Â if (settings-&gt;fontFallbackPrefersPictographs())</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â documentStyle.fontCascade().update(&amp;fontSelector());</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â }</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span>Â Â  Â <span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">documentChangeÂ Â Â Â Â WebCore::Style::ChangeÂ Â Â Â Â NoChange</font></span></span><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â auto documentChange = Style::determineChange(documentStyle, m_renderView-&gt;style());</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â if (documentChange != Style::NoChange)</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â Â Â Â Â renderView()-&gt;setStyle(WTFMove(documentStyle));</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â }</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span>Â  Â  // âœ¨ã€é‡ç‚¹çªç ´ç‚¹ã€‘âœ¨</span><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Style::TreeResolver resolver(*this);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â auto styleUpdate = resolver.resolve(change);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â clearNeedsStyleRecalc();</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â clearChildNeedsStyleRecalc();</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â unscheduleStyleRecalc();</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â m_inStyleRecalc = false;</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â if (styleUpdate) {</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â TemporaryChange&lt;bool&gt; inRenderTreeUpdate(m_inRenderTreeUpdate, true);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â RenderTreeUpdater updater(*this);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â Â  Â <span>Â  Â  // âœ¨ã€é‡ç‚¹çªç ´ç‚¹ã€‘<font style="font-family: Monaco; font-size: 12px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51);">æœ€ç»ˆè¿›å…¥è¿™é‡Œå¼€å§‹å¾ªç¯éå†</font>âœ¨</span></span><br/></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â updater.commit(WTFMove(styleUpdate));</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â }</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â updatedCompositingLayers = frameView.updateCompositingLayersAfterStyleChange();</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">}</font><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"/></div></div><div><br/></div><div>ğŸŒŸä¸º document èŠ‚ç‚¹åˆ›å»ºæ ·å¼å¯¹è±¡ï¼š</div><div/><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#1Â Â Â Â Â 0x00000001070ba4a8 in WebCore::Document::recalcStyle(WebCore::Style::Change) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/dom/Document.cpp:1864</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0Â Â Â Â Â 0x0000000108be996b in WebCore::Style::resolveForDocument(WebCore::Document const&amp;) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/style/StyleResolveForDocument.cpp:58</font></div><div><br/></div><div>// å¯ä»¥ç†è§£ï¼Œæ­¤å‡½æ•°åº”è¯¥ä¸ºä¸€ä¸ªé™æ€å‡½æ•°</div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">RenderStyle resolveForDocument(const Document&amp; document)</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">{<span>Â  Â </span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span>Â  Â  // ç¡®ä¿ document æœ‰è‡ªå·±çš„ RenderView å¯¹è±¡</span><br/></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â ASSERT(document.hasLivingRenderTree());</font></div><div><span>Â  Â  // è·å– renderView å¯¹è±¡</span><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â RenderView&amp; renderView = *document.renderView();</font></div><div><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">documentStyleÂ Â Â Â Â WebCore::RenderStyle Â  Â Â </font></span><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â  Â  auto documentStyle = RenderStyle::create();</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // çœ‹èµ·ç»“æ„ï¼š</span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">noninherited_flagsÂ Â Â Â Â WebCore::RenderStyle::NonInheritedFlags Â  Â  ã€æ–°è®¾ç½®çš„å€¼ä¼šå†™åœ¨è¿™é‡Œã€‘</font></span><br/></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">inherited_flagsÂ Â Â Â Â WebCore::RenderStyle::InheritedFlags Â  Â  ã€ä¼šç»§æ‰¿ä¸€äº›é»˜è®¤å±æ€§å€¼ã€‘</font></span><br/></font></span></span></font></div><div><span>Â Â  Â <img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%EF%BC%88%20%E5%8F%8A%E5%85%B6%E6%B8%B2%E6%9F%93%E8%87%B3%E5%B1%8F%E5%B9%95%20%EF%BC%89%20-%201.resources/A629F842-D77C-4881-99DD-CE58DDE9D54B.png" height="232" width="647"/><br/></span><br/></div><div><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">m_flagsÂ Â Â Â Â uint64_tÂ Â Â Â Â 256</font></span><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â documentStyle.setDisplay(BLOCK);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â documentStyle.setRTLOrdering(document.visuallyOrdered() ? VisualOrder : LogicalOrder);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // è®¾ç½®ç¼©æ”¾çº§åˆ«</span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â documentStyle.setZoom(!document.printing() ? renderView.frame().pageZoomFactor() : 1);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â  Â  . . .</font></div><div><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">docElementÂ Â Â Â Â WebCore::HTMLHtmlElement *Â Â Â Â Â 0x124e3cd68Â Â Â Â Â 0x0000000124e3cd68</font></span><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Element* docElement = document.documentElement();</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â RenderObject* docElementRenderer = docElement ? docElement-&gt;renderer() : nullptr;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">docElementRendererÂ Â Â Â Â WebCore::RenderObject *Â Â Â Â Â NULLÂ Â Â Â Â 0x0000000000000000</font></span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â if (docElementRenderer) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â  Â  Â  Â  . . .</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â }</font></div><div><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">paginationÂ Â Â Â Â const WebCore::Pagination &amp;Â Â Â Â Â 0x00000001169f8110</font></span><br/></div><div><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  //Â <span>Â Â  Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">modeÂ Â Â Â Â WebCore::Pagination::ModeÂ Â Â Â Â Unpaginated</font></span></span><br/></font></span></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â const Pagination&amp; pagination = renderView.frameView().pagination();</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â if (pagination.mode != Pagination::Unpaginated) {</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â  Â  Â  Â  . . .</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â }</font></div><div><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">settingsÂ Â Â Â Â const WebCore::Settings &amp;Â Â Â Â Â 0x00000001153c1000</font></span><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â const Settings&amp; settings = renderView.frame().settings();</font></div><div><span>Â  Â  // ä»¥ä¸‹ä¸ºè®¾ç½®å­—ä½“ç›¸å…³</span></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â FontCascadeDescription fontDescription;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â fontDescription.setLocale(document.contentLanguage());</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â fontDescription.setRenderingMode(settings.fontRenderingMode());</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â fontDescription.setOneFamily(standardFamily);</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â fontDescription.setKeywordSizeFromIdentifier(CSSValueMedium);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â int size = fontSizeForKeyword(CSSValueMedium, false, document);</font></div><div><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">sizeÂ Â Â Â Â intÂ Â Â Â Â 16</font></span><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â fontDescription.setSpecifiedSize(size);</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â  Â  . . .</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  // è®¾ç½®å­—ä½“å±æ€§ç»“æŸ</span><br/></font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â documentStyle.setFontDescription(fontDescription);</font></div><div><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â documentStyle.fontCascade().update(&amp;const_cast&lt;Document&amp;&gt;(document).fontSelector());</font></div><div><span>Â  Â  // æœ€ç»ˆå°†åˆå§‹åŒ–å¥½çš„ documentStyle å¯¹è±¡è¿”å›</span><br/></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â return documentStyle;</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">}</font></div><div><br/><br/></div></div><div><hr/>å¼€å§‹è¿›å…¥æ¸²æŸ“æ ‘æ›´æ–°é˜¶æ®µï¼š</div><div/><div style="box-sizing: border-box; padding: 8px; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0Â Â Â Â Â 0x000000010886f05d in WebCore::RenderTreeUpdater::commit(std::__1::unique_ptr&lt;WebCore::Style::Update, std::__1::default_delete&lt;WebCore::Style::Update&gt; &gt;) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/style/RenderTreeUpdater.cpp:98</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">void RenderTreeUpdater::commit(std::unique_ptr&lt;Style::Update&gt; styleUpdate)</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">{</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â ASSERT(&amp;m_document == &amp;styleUpdate-&gt;document());</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â if (!m_document.shouldCreateRenderers() || !m_document.renderView())</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â return;</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â m_styleUpdate = WTFMove(styleUpdate);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â for (auto* root : findRenderingRoots(*m_styleUpdate))</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â Â  Â <span>Â  Â  // è¿›å…¥è¿™é‡ŒÂ </span></span><br/></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><span>Â Â  Â <span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">rootÂ Â Â Â Â WebCore::HTMLDocument *Â Â Â Â Â 0x116f7f600Â Â Â Â Â 0x0000000116f7f600</font></span></span><br/></span></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â Â Â Â Â updateRenderTree(*root);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â m_styleUpdate = nullptr;</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">}</font><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0Â Â Â Â Â 0x000000010886f35c in WebCore::RenderTreeUpdater::updateRenderTree(WebCore::ContainerNode&amp;) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/style/RenderTreeUpdater.cpp:115</font></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">void RenderTreeUpdater::updateRenderTree(ContainerNode&amp; root)</font></font></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">{</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">thisÂ Â Â Â Â WebCore::RenderTreeUpdater *Â Â Â Â Â 0x7fff5fbfce60Â Â Â Â Â 0x00007fff5fbfce60</font></span><br/></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">rootÂ Â Â Â Â WebCore::HTMLDocument &amp;Â Â Â Â Â 0x0000000116f7f600</font></span><br/></font></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>Â  Â  //Â <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">m_parentStackÂ Â Â Â Â WTF::Vector&lt;WebCore::RenderTreeUpdater::Parent, 0, WTF::CrashOnOverflow, 16&gt;Â Â Â Â Â </font></span><br/></font></span></font></span></font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â ASSERT(root.renderer());</font></div><div><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â ASSERT(m_parentStack.isEmpty());</font></div><div><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">Â Â Â Â m_parentStack.append(Parent(root));</font><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">. . .</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"/></div><div><br/></div><div>è¿›å…¥ä¸‹ä¸€èŠ‚å†å…·ä½“åˆ†æ</div><div><br/></div></body></html>