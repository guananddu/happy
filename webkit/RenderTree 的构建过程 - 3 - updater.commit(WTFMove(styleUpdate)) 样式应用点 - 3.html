<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454267)"/><meta name="author" content="管伟"/><meta name="created" content="2016-12-21 08:24:54 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2016-12-24 07:53:13 +0000"/><title>RenderTree 的构建过程 - 3 - updater.commit(WTFMove(styleUpdate)) 样式应用点 - 3</title></head><body><style>
    a { color: #43B0D6 !important; }
    a:visited { color: #7b7ed2 !important; }
    .title-p { font-size:12px; color:gray; }
    .title-hr { margin-bottom: 20px; }
    .tail-hr { margin-top: 20px; }
    .tail-licenses { border:1px dashed lightgray; margin:20px 0 20px 0; padding:20px; font-size:14px; }
</style>
<h2>RenderTree 的构建过程 - 3 - updater.commit(WTFMove(styleUpdate)) 样式应用点 - 3</h2>
<p class="title-p">版权声明：自由转载-非商用-非衍生-保持署名(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>)</p>
<p class="title-p">文章作者：Pooky (<a href="mailto:guananddu@icloud.com">guananddu@icloud.com</a>)</p>
<hr class="title-hr"><div>关于 insertionPosition.insert 的细节分析：</div><div><br/></div><div/><div style="box-sizing: border-box; padding: 8px; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0     0x00000001087d8a18 in WebCore::RenderTreePosition::insert(WebCore::RenderObject&amp;) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/style/RenderTreePosition.h:91</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">inline void RenderTreePosition::insert(RenderObject&amp; renderer)</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">{</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    // <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">this     WebCore::RenderTreePosition *     0x7fff5fbfa130     0x00007fff5fbfa130</font></span><br/></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    <img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%20-%203%20-%20updater.commit(WTFMove(styleUpdate))%20%E6%A0%B7%E5%BC%8F%E5%BA%94%E7%94%A8%E7%82%B9%20-%203.resources/8C2FBDFE-9101-4FF2-8258-0DD53E4C0CF9.png" height="auto" width="100%"/><br/></span><br/></font></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span>    // 当前的插入逻辑，是在插入 HTMLHtmlElement 节点的 renderer</span><br/></span></font></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><span>    // <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">renderer     WebCore::RenderBlockFlow &amp;     0x0000000114e19e38</font></span><br/></span></span></font></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></span></span></span></font></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    <img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%20-%203%20-%20updater.commit(WTFMove(styleUpdate))%20%E6%A0%B7%E5%BC%8F%E5%BA%94%E7%94%A8%E7%82%B9%20-%203.resources/79277769-F15A-43D0-BFA4-4E4782100974.png" height="auto" width="100%"/><br/></span><br/></font></span></span></span></font></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span>    // <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">m_hasValidNextSibling     bool     true</font></span><br/></span></font></span></span></span></font></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    // <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">m_nextSibling     WebCore::RenderObject *     NULL     0x0000000000000000</font></span><br/></font></span></span></font></span></span></span></font></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">    ASSERT(m_hasValidNextSibling);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    // <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">addChild(RenderObject* newChild, RenderObject* beforeChild)</font></span></font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">    m_parent.addChild(&amp;renderer, m_nextSibling);</font></div><div style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">}</font><br/></div><div><font face="Monaco">====&gt;</font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0     0x00000001084c8462 in WebCore::RenderBlockFlow::addChild(WebCore::RenderObject*, WebCore::RenderObject*) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/rendering/RenderBlockFlow.cpp:3859</font></font></div><div><br/><font face="Monaco">====&gt;</font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0     0x000000010847c308 in WebCore::RenderBlock::addChild(WebCore::RenderObject*, WebCore::RenderObject*) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/rendering/RenderBlock.cpp:415</font></font></div><div><br/><font face="Monaco">====&gt;</font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0     0x000000010847c38b in WebCore::RenderBlock::addChildIgnoringContinuation(WebCore::RenderObject*, WebCore::RenderObject*) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/rendering/RenderBlock.cpp:423</font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></font></div><div><font face="Monaco">这里有一些有趣的逻辑：</font></div><div><font face="Monaco"><br/></font></div><div><font face="Monaco"/></div><div><img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%20-%203%20-%20updater.commit(WTFMove(styleUpdate))%20%E6%A0%B7%E5%BC%8F%E5%BA%94%E7%94%A8%E7%82%B9%20-%203.resources/D4561AC3-1BEA-4FF4-B677-AE92740147B5.png" height="auto" width="100%"/><br/></div><div><br/></div><div><img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%20-%203%20-%20updater.commit(WTFMove(styleUpdate))%20%E6%A0%B7%E5%BC%8F%E5%BA%94%E7%94%A8%E7%82%B9%20-%203.resources/6916A977-AD7C-49AC-A8A2-A86A573C88B4.png" height="auto" width="100%"/><br/></div><div><br/><font face="Monaco">====&gt;</font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0     0x000000010854e158 in WebCore::RenderElement::addChild(WebCore::RenderObject*, WebCore::RenderObject*) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/rendering/RenderElement.cpp:486</font></font></div><div><br/></div><div><font face="Monaco">这里有处理 table 渲染的逻辑</font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">====&gt;</font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">#0     0x000000010854e30f in WebCore::RenderElement::insertChildInternal(WebCore::RenderObject*, WebCore::RenderObject*, WebCore::RenderElement::NotifyChildrenType) at /Users/mrguan/work/svn/Webkit/WebKit/Source/WebCore/rendering/RenderElement.cpp:537</font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">[[</font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">this     WebCore::RenderView *     0x1173ada00     0x00000001173ada00</font></span><br/></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></span></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    <img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%20-%203%20-%20updater.commit(WTFMove(styleUpdate))%20%E6%A0%B7%E5%BC%8F%E5%BA%94%E7%94%A8%E7%82%B9%20-%203.resources/9E17306B-9408-473F-A36C-30FE2CEDC2C5.png" height="auto" width="100%"/><br/></span><br/></font></span></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span>    <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">newChild     WebCore::RenderBlockFlow *     0x114e19e38     0x0000000114e19e38</font></span><br/></span></font></span></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></font></span></span></font></span></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    <img src="RenderTree%20%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%20-%203%20-%20updater.commit(WTFMove(styleUpdate))%20%E6%A0%B7%E5%BC%8F%E5%BA%94%E7%94%A8%E7%82%B9%20-%203.resources/3F2265DB-A794-4DFD-B3E6-F143F6B27A02.png" height="auto" width="100%"/><br/></span><br/></font></span></span></font></span></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span>    <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">beforeChild     WebCore::RenderObject *     NULL     0x0000000000000000</font></span><br/></span></font></span></span></font></span></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">notifyChildren     NotifyChildrenType     NotifyChildren</font></span><br/></font></span></span></font></span></span></font></span></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"/></span></span></font></span></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">]]</font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    . . .</span><br/></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    <font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">newChild-&gt;setParent(this);</font></span><br/></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    . . .</span><br/></font></span></font></font></font></div><div><font face="Monaco"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span><font style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><span>    </span></font></span></font></font></font></div></div><div><br/></div><div><br/></div><div><br/></div>

<hr class="tail-hr">
<div class="tail-licenses">
<p>版权声明：自由转载-非商用-非衍生-保持署名(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>)</p>
<p>文章作者：Pooky (<a href="mailto:guananddu@icloud.com">guananddu@icloud.com</a>)</p>
<p>更新日期：Sat Dec 24 2016 16:00:43 GMT+0800 (CST)</p>
</div></body></html>